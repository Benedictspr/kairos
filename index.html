<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <script src="js/auth-guard.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KAIROS | Command Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;700&family=JetBrains+Mono:wght@500&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="css/dashboard.css">

    <script src="js/components.js"></script>
    <script>
        const savedTheme = localStorage.getItem('kairosTheme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);

        // Data Persistence Init
        window.addEventListener('DOMContentLoaded', () => {
            renderSidebar('dashboard');

            const user = localStorage.getItem('kairos_user') || 'Guest';
            const job = localStorage.getItem('kairos_job_title') || 'Professional';
            const email = localStorage.getItem('kairos_email') || 'guest@kairos.ai';
            const bio = localStorage.getItem('kairos_bio') || 'User';

            // Extended Fields
            const role = localStorage.getItem('kairos_role_desc') || job;
            const loc = localStorage.getItem('kairos_location') || 'Lagos, Nigeria';
            const proj = localStorage.getItem('kairos_project') || '';
            const phone = localStorage.getItem('kairos_phone') || '';
            const links = localStorage.getItem('kairos_links') || '';
            const alias = localStorage.getItem('kairos_alias') || '';
            const reminders = localStorage.getItem('kairos_reminders') || '15 mins';
            const notify = localStorage.getItem('kairos_notify') === 'false' ? false : true;

            // Update Sidebar Dock
            const dockName = document.getElementById('dockName');
            if (dockName) dockName.innerText = user;

            const dockAvatar = document.getElementById('dockAvatar');
            const savedAvatar = localStorage.getItem('kairos_avatar');
            if (dockAvatar) {
                if (savedAvatar) {
                    dockAvatar.innerHTML = `<img src="${savedAvatar}" style="width:100%; height:100%; object-fit:cover;">`;
                } else {
                    const initials = user.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                    dockAvatar.innerHTML = `<span>${initials}</span>`;
                }
            }

            // Update Profile Modal Inputs
            if (document.getElementById('displayProfName')) document.getElementById('displayProfName').value = user;
            if (document.getElementById('displayJobTitle')) document.getElementById('displayJobTitle').value = job;
            if (document.getElementById('profileInitials')) document.getElementById('profileInitials').innerText = user.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();

            if (document.getElementById('pf_role')) document.getElementById('pf_role').value = role;
            if (document.getElementById('pf_loc')) document.getElementById('pf_loc').value = loc;
            if (document.getElementById('pf_proj')) document.getElementById('pf_proj').value = proj;

            if (document.getElementById('pf_email')) document.getElementById('pf_email').value = email;
            if (document.getElementById('pf_phone')) document.getElementById('pf_phone').value = phone;
            if (document.getElementById('pf_links')) document.getElementById('pf_links').value = links;
            if (document.getElementById('pf_alias')) document.getElementById('pf_alias').value = alias;

            if (document.getElementById('pf_reminders')) document.getElementById('pf_reminders').value = reminders;

            // Notification State
            if (document.getElementById('set_notify_icon')) {
                updateNotifyUI(notify);
            }

            // Logo Init
            updateLogoTheme();
        });

        function updateLogoTheme() {
            const theme = document.documentElement.getAttribute('data-theme');
            const logo = document.getElementById('dashLogo');
            if (logo) {
                logo.src = theme === 'dark' ? 'icons/new-Kairos-Logo-white.png' : 'icons/new-Kairos-Logo-black.png';
            }
        }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const newTheme = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('kairosTheme', newTheme);
            document.getElementById('themeIcon').className = newTheme === 'dark' ? 'ph-bold ph-moon' : 'ph-bold ph-sun';
            updateLogoTheme();
        }

        function saveDashboardProfile() {
            const name = document.getElementById('displayProfName').value;
            const job = document.getElementById('displayJobTitle').value;
            const role = document.getElementById('pf_role').value;
            const loc = document.getElementById('pf_loc').value;
            const proj = document.getElementById('pf_proj').value;
            const email = document.getElementById('pf_email').value;
            const phone = document.getElementById('pf_phone').value;
            const links = document.getElementById('pf_links').value;
            const alias = document.getElementById('pf_alias').value;

            localStorage.setItem('kairos_user', name);
            localStorage.setItem('kairos_job_title', job);
            localStorage.setItem('kairos_role_desc', role);
            localStorage.setItem('kairos_location', loc);
            localStorage.setItem('kairos_project', proj);
            localStorage.setItem('kairos_email', email);
            localStorage.setItem('kairos_phone', phone);
            localStorage.setItem('kairos_links', links);
            localStorage.setItem('kairos_alias', alias);

            showToast('Profile Updated');
            // Refresh visuals
            document.getElementById('dockName').innerText = name;
            document.getElementById('profileInitials').innerText = name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        }

        function saveSetting(key, val) {
            localStorage.setItem('kairos_' + key, val);
            showToast('Setting Saved');
        }

        function toggleSetting(key) {
            const current = localStorage.getItem('kairos_' + key) === 'false' ? false : true;
            const newVal = !current;
            localStorage.setItem('kairos_' + key, newVal);
            if (key === 'notify') updateNotifyUI(newVal);
        }

        function updateNotifyUI(isOn) {
            const icon = document.getElementById('set_notify_icon');
            const text = document.getElementById('set_notify_text');
            if (isOn) {
                icon.className = "ph-bold ph-toggle-right";
                icon.style.color = "#10b981";
                text.innerText = "On";
            } else {
                icon.className = "ph-bold ph-toggle-left";
                icon.style.color = "#666";
                text.innerText = "Off";
            }
        }

        function signOut() {
            localStorage.setItem('kairos_auth', 'false');
            window.location.href = 'login.html';
        }
    </script>
</head>

<body>

    <div id="toast"><i class="ph-bold ph-check-circle"></i> <span id="toastMsg">Action Complete</span></div>


    <div id="sidebar-container"></div>

    <main id="main">
        <div id="view-dashboard" class="view-section active">
            <div class="dashboard-content">
                <header class="time-header">
                    <div>
                        <div class="main-clock" id="clock">00:00</div>
                        <div class="date-display" id="date">Loading...</div>
                    </div>
                    <div class="world-clocks">
                        <div class="wc-item">
                            <div class="wc-city">Lagos</div>
                            <div class="wc-time" id="time-lagos">--:--</div>
                        </div>
                        <div class="wc-item">
                            <div class="wc-city">London</div>
                            <div class="wc-time" id="time-ldn">--:--</div>
                        </div>
                    </div>
                </header>

                <div class="grid-layout">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="ph-duotone ph-calendar-blank"></i> <span
                                    id="calMonth">January</span></div>
                            <div style="display:flex; gap:4px;">
                                <button class="theme-toggle" style="width:24px; height:24px;" title="Sync from Device"
                                    onclick="initCalendarAuth()">
                                    <i class="ph-bold ph-arrows-clockwise"></i>
                                </button>
                                <button class="theme-toggle" style="width:24px; height:24px;"
                                    onclick="changeMonth(-1)"><i class="ph-bold ph-caret-left"></i></button>
                                <button class="theme-toggle" style="width:24px; height:24px;"
                                    onclick="changeMonth(1)"><i class="ph-bold ph-caret-right"></i></button>
                            </div>
                        </div>
                        <div class="cal-grid" id="calendarGrid"></div>
                    </div>

                    <div class="card" style="padding:0; gap:0;">
                        <div
                            style="padding:20px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                            <div class="card-title"><i class="ph-duotone ph-lightning"></i> Action Center</div>
                            <div
                                style="font-size:10px; background:rgba(255,255,255,0.1); padding:2px 8px; border-radius:12px;">
                                2 Pending</div>
                        </div>

                        <div
                            style="padding:16px; background:rgba(16, 185, 129, 0.03); border-bottom:1px solid var(--border);">
                            <div
                                style="font-size:10px; font-weight:700; text-transform:uppercase; color:#10b981; margin-bottom:8px;">
                                AI Draft â€¢ Needs Approval</div>
                            <div
                                style="background:var(--bg-main); border:1px solid var(--border); border-radius:12px; padding:12px; margin-bottom:8px;">
                                <div style="font-size:12px; font-weight:600; margin-bottom:4px;">Email to Sparky
                                    Solutions</div>
                                <p style="font-size:11px; color:var(--text-secondary); margin-bottom:8px;">"Requesting
                                    quote for office wiring based on Tues meeting..."</p>
                                <div style="display:flex; gap:8px;">
                                    <button
                                        style="flex:1; background:#10b981; color:#000; font-size:10px; font-weight:700; padding:6px; border-radius:6px;"
                                        onclick="showToast('Email Sent')">Approve</button>
                                    <button
                                        style="flex:1; background:var(--surface-hover); color:var(--text-primary); font-size:10px; font-weight:600; padding:6px; border-radius:6px;">Edit</button>
                                </div>
                            </div>
                        </div>

                        <div class="agenda-feed" id="agendaList" style="padding:16px;"></div>
                        <div style="padding:16px; border-top:1px solid var(--border);">
                            <button class="btn-primary" onclick="openScheduleModal()" style="margin:0;">
                                <i class="ph-bold ph-plus"></i> New Event
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-teamchat" class="view-section">
            <div class="view-header">
                <div class="view-title">Team Chat</div>
                <div style="display:flex; gap:12px;">
                    <button class="theme-toggle"><i class="ph-bold ph-magnifying-glass"></i></button>
                    <button class="theme-toggle"><i class="ph-bold ph-dots-three"></i></button>
                </div>
            </div>
            <div class="pill-nav-container">
                <div class="pill-nav active">All</div>
                <div class="pill-nav">Mentions</div>
                <div class="pill-nav">Chats</div>
                <div class="pill-nav">Channels</div>
                <div class="pill-nav">Meeting chat</div>
            </div>
            <div class="content-list" id="chatListContainer"></div>
            <div class="fab-container">
                <button class="btn-primary" onclick="openNewTeamWizard()"
                    style="width:56px; height:56px; border-radius:50%; box-shadow:0 10px 30px rgba(0,0,0,0.3); display:flex; align-items:center; justify-content:center;">
                    <i class="ph-bold ph-plus" style="font-size:24px;"></i>
                </button>
            </div>
        </div>

        <div id="view-chat-detail" class="view-section">
            <div class="view-header">
                <div style="display:flex; align-items:center; gap:12px;">
                    <button class="theme-toggle" onclick="closeChatDetail()"><i
                            class="ph-bold ph-arrow-left"></i></button>
                    <div>
                        <div class="view-title" id="chatDetailTitle" style="font-size:16px;">Chat Name</div>
                        <div style="font-size:11px; color:var(--text-secondary);">Online</div>
                    </div>
                </div>
                <button class="theme-toggle"><i class="ph-bold ph-video-camera"></i></button>
            </div>
            <div class="content-list" id="chatDetailMessages"
                style="display:flex; flex-direction:column; padding-top:20px;">
            </div>
            <div style="padding:16px; background:var(--bg-panel); border-top:1px solid var(--border);">
                <div style="display:flex; gap:8px;">
                    <input type="text" class="input-field" placeholder="Type a message..." style="border-radius:20px;">
                    <button class="btn-primary" style="width:46px; margin:0; border-radius:50%;"><i
                            class="ph-bold ph-paper-plane-right"></i></button>
                </div>
            </div>
        </div>

        <div id="view-docs" class="view-section">
            <div class="view-header">
                <div class="view-title">Docs</div>
                <div style="display:flex; gap:12px;">
                    <button class="theme-toggle"><i class="ph-bold ph-magnifying-glass"></i></button>
                    <button class="theme-toggle"><i class="ph-bold ph-bell"></i></button>
                </div>
            </div>
            <div class="pill-nav-container">
                <div class="pill-nav active accent-pill" onclick="filterDocs('all', this)">All</div>
                <div class="pill-nav" onclick="filterDocs('recent', this)">Recent</div>
                <div class="pill-nav" onclick="filterDocs('starred', this)">Starred</div>
                <div class="pill-nav" onclick="filterDocs('shared', this)">Shared</div>
            </div>
            <div class="content-list" style="position:relative;" id="docsList"></div>
            <div class="fab-docs-raised">
                <button class="btn-primary" onclick="createNewDoc()"
                    style="width:56px; height:56px; border-radius:50%; box-shadow:0 10px 30px rgba(0,0,0,0.3); display:flex; align-items:center; justify-content:center; background:#10b981;">
                    <i class="ph-bold ph-plus" style="font-size:24px; color:#000;"></i>
                </button>
            </div>
        </div>
    </main>

    <div id="newDocModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Create New Document</h3>
                <div class="close-btn" onclick="closeModals()"><i class="ph-bold ph-x"></i></div>
            </div>
            <div class="form-group">
                <label class="form-label">Document Name</label>
                <input type="text" id="newDocInput" class="input-field" placeholder="e.g. Q1 Marketing Plan" autofocus>
            </div>
            <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:16px;">
                <button class="theme-toggle" style="width:auto; padding:0 16px; border:none;"
                    onclick="closeModals()">Cancel</button>
                <button class="btn-primary" style="width:auto; margin:0;" onclick="saveNewDoc()">Create</button>
            </div>
        </div>
    </div>

    <div id="meetingHub" class="modal-overlay">
        <div class="modal-card">
            <div
                style="background:var(--bg-main); padding:12px; border-radius:12px; display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; border:1px solid var(--border);">
                <div style="display:flex; align-items:center; gap:10px;">
                    <div
                        style="width:32px; height:32px; background:rgba(16,185,129,0.1); color:#10b981; border-radius:8px; display:flex; align-items:center; justify-content:center;">
                        <i class="ph-bold ph-brain"></i>
                    </div>
                    <div>
                        <div style="font-size:13px; font-weight:600;">Org Memory</div>
                        <div style="font-size:10px; color:var(--text-secondary);">Record & extract decisions</div>
                    </div>
                </div>
                <label style="position: relative; display: inline-block; width: 40px; height: 20px;">
                    <input type="checkbox" checked style="opacity: 0; width: 0; height: 0;">
                    <span
                        style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px;"
                        onclick="this.style.backgroundColor = this.style.backgroundColor === 'rgb(16, 185, 129)' ? '#333' : '#10b981'">
                        <span
                            style="position: absolute; content: ''; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; transform: translateX(18px);"></span>
                    </span>
                </label>
            </div>
            <div class="meeting-grid">
                <button class="meeting-opt" onclick="openStartCallModal()">
                    <div class="meeting-icon"><i class="ph-fill ph-video-camera"></i></div>
                    <span class="meeting-label">Start meeting</span>
                </button>
                <button class="meeting-opt" onclick="openLinkModal()">
                    <div class="meeting-icon"><i class="ph-bold ph-link"></i></div>
                    <span class="meeting-label">New meeting link</span>
                </button>
                <button class="meeting-opt" onclick="openDialPad()">
                    <div class="meeting-icon"><i class="ph-bold ph-phone"></i></div>
                    <span class="meeting-label">Call a number</span>
                </button>
                <button class="meeting-opt" onclick="openScheduleModal()">
                    <div class="meeting-icon"><i class="ph-bold ph-calendar-plus"></i></div>
                    <span class="meeting-label">Schedule meeting</span>
                </button>
            </div>
            <button onclick="closeModals()"
                style="width:100%; margin-top:20px; padding:12px; color:#888;">Close</button>
        </div>
    </div>

    <div id="startCallModal" class="modal-overlay">
        <div class="modal-card" style="text-align:center;">
            <div id="startCallContent">
                <div class="modal-header">
                    <h3>Start Meeting</h3>
                    <div class="close-btn" onclick="closeModals()"><i class="ph-bold ph-x"></i></div>
                </div>

                <div class="form-group" style="text-align:left; margin-bottom: 20px;">
                    <label class="form-label">Meeting Name</label>
                    <input type="text" id="dashboardMeetingName" class="input-field" placeholder="e.g. Daily Standup"
                        value="New Meeting">
                </div>

                <p style="color:#888; font-size:13px; margin-bottom:10px;">Choose mode to start</p>
                <div class="call-type-row">
                    <div class="call-type-btn" onclick="initiateCall('Audio')">
                        <i class="ph-fill ph-phone call-type-icon"></i>
                        <span style="font-size:12px; font-weight:600;">Audio</span>
                    </div>
                    <div class="call-type-btn" onclick="initiateCall('Video')">
                        <i class="ph-fill ph-video-camera call-type-icon"></i>
                        <span style="font-size:12px; font-weight:600;">Video</span>
                    </div>
                </div>
            </div>
            <div id="preCallLoader" style="display:none; padding:20px 0;">
                <div class="spinner-large"></div>
                <h3 style="margin-top:20px; font-family:'Space Grotesk'">Connecting...</h3>
                <p style="color:var(--text-secondary); font-size:13px; margin-top:8px;" id="connText">Establishing
                    secure link</p>
                <p style="color:var(--text-secondary); font-size:11px; margin-top:4px;">Waiting for participants to
                    join...</p>
            </div>
        </div>
    </div>

    <div id="scheduleModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3 id="schedModalTitle">Schedule meeting</h3>
                <div class="close-btn" onclick="closeModals()"><i class="ph-bold ph-x"></i></div>
            </div>
            <div class="form-group">
                <label class="form-label">Meeting name</label>
                <input type="text" id="schedName" class="input-field" value="KAIROS Sync"
                    style="border-bottom: 2px solid #10b981; border-radius: 4px 4px 0 0;">
            </div>
            <div class="form-group">
                <input type="text" id="schedDesc" class="input-field" placeholder="Description (optional)">
            </div>
            <div class="form-group">
                <label class="form-label">Start date and time</label>
                <div class="date-row">
                    <input type="date" id="schedStartDate" class="input-field">
                    <input type="time" id="schedStartTime" class="input-field">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">End date and time</label>
                <div class="date-row">
                    <input type="date" id="schedEndDate" class="input-field">
                    <input type="time" id="schedEndTime" class="input-field">
                </div>
            </div>
            <div style="margin-top:24px; display:flex; justify-content:flex-end;">
                <button class="btn-primary" style="width:auto; border-radius:30px; margin:0;" onclick="saveEvent()">
                    <span id="schedBtnText">Schedule</span> <i class="ph-bold ph-paper-plane-right"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="linkModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3>New meeting link</h3>
                <div class="close-btn" onclick="closeModals()"><i class="ph-bold ph-x"></i></div>
            </div>
            <div class="av-toggle">
                <div class="av-btn active" id="btnVideo" onclick="toggleLinkType('video')"><i
                        class="ph-fill ph-video-camera"></i> Video</div>
                <div class="av-btn" id="btnAudio" onclick="toggleLinkType('audio')"><i
                        class="ph-fill ph-microphone"></i> Audio</div>
            </div>
            <div class="call-link-box">
                <div class="link-text" id="callLink">https://call.kairos.ai/video/bSecFu...</div>
                <button class="copy-btn" onclick="copyLink()"><i class="ph-bold ph-copy"></i></button>
            </div>
            <p style="font-size:12px; color:#888; line-height:1.4; margin-bottom:20px;">
                Anyone with WhatsApp can use this link to join this meeting. Only share it with people you trust.
            </p>
            <div style="display:flex; gap:12px; align-items:center;">
                <button class="btn-primary" style="margin:0; background:#fff; color:#000; flex:1;"
                    onclick="sendToWhatsapp()">
                    <i class="ph-bold ph-whatsapp-logo"></i> Send link
                </button>
            </div>
        </div>
    </div>

    <div id="dialPadModal" class="modal-overlay">
        <div class="modal-card" style="width:320px;">
            <div class="modal-header">
                <h3>Phone</h3>
                <div class="close-btn" onclick="closeModals()"><i class="ph-bold ph-x"></i></div>
            </div>
            <div class="dial-display" id="dialDisplay"></div>
            <div class="dial-grid">
                <div class="dial-key" onclick="pressKey('1')">1</div>
                <div class="dial-key" onclick="pressKey('2')">2</div>
                <div class="dial-key" onclick="pressKey('3')">3</div>
                <div class="dial-key" onclick="pressKey('4')">4</div>
                <div class="dial-key" onclick="pressKey('5')">5</div>
                <div class="dial-key" onclick="pressKey('6')">6</div>
                <div class="dial-key" onclick="pressKey('7')">7</div>
                <div class="dial-key" onclick="pressKey('8')">8</div>
                <div class="dial-key" onclick="pressKey('9')">9</div>
                <div class="dial-key" onclick="pressKey('*')">*</div>
                <div class="dial-key" onclick="pressKey('0')">0</div>
                <div class="dial-key" onclick="pressKey('#')">#</div>
                <div class="dial-key" style="background:transparent;"></div>
                <div class="dial-key dial-action" onclick="showToast('Calling number...')"><i
                        class="ph-fill ph-phone-call"></i></div>
                <div class="dial-key" style="background:transparent; font-size:24px;" onclick="pressKey('del')"><i
                        class="ph-fill ph-backspace"></i></div>
            </div>
        </div>
    </div>

    <div id="teamModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Team Sync</h3>
                <div class="close-btn" onclick="closeModals()"><i class="ph-bold ph-x"></i></div>
            </div>
            <div class="form-group">
                <label class="form-label">Add Member</label>
                <input type="text" id="newMemberInput" class="input-field" placeholder="Email or Phone Number">
            </div>
            <div class="form-group">
                <label class="form-label">Assign to Team</label>
                <div style="display:flex; gap:8px;">
                    <select id="teamSelector" class="input-field" style="appearance:none; cursor:pointer;">
                        <option value="" disabled selected>Select Team...</option>
                    </select>
                    <button class="btn-primary" style="width:auto; margin:0;" onclick="addMember()">Add</button>
                </div>
            </div>
            <div class="team-list" id="teamList">
                <div class="team-member">
                    <div class="member-info">
                        <div class="member-avatar">A</div>
                        <div>
                            <span style="font-size:13px; font-weight:600; display:block;">Alice Design</span>
                            <span style="font-size:10px; color:var(--text-secondary);">Design Team</span>
                        </div>
                    </div>
                    <div style="font-size:10px; color:#10b981;">Online</div>
                </div>
            </div>
        </div>
    </div>

    <div id="newTeamWizard" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3 id="wizTitle">Create New Team</h3>
                <div class="close-btn" onclick="closeModals()"><i class="ph-bold ph-x"></i></div>
            </div>
            <div class="step-indicator">
                <div class="step-dot active" id="dot1"></div>
                <div class="step-dot" id="dot2"></div>
                <div class="step-dot" id="dot3"></div>
            </div>
            <div id="wizStep1" class="wizard-step active">
                <div style="text-align:center; margin-bottom:20px;">
                    <div
                        style="width:60px; height:60px; background:rgba(16,185,129,0.1); border-radius:50%; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; color:#10b981; font-size:24px;">
                        <i class="ph-bold ph-users-three"></i>
                    </div>
                    <h4 style="margin-bottom:4px;">Who's in?</h4>
                    <p style="font-size:12px; color:#888;">Add members by email or phone.</p>
                </div>
                <div class="form-group">
                    <input type="text" id="wizMemberInput" class="input-field" placeholder="colleague@kairos.ai">
                </div>
                <div class="team-list" id="wizMemberList"
                    style="max-height:100px; overflow-y:auto; margin-bottom:16px;"></div>
                <button class="btn-primary" onclick="wizAddMember()"
                    style="background:var(--surface-hover); color:var(--text-primary); margin-bottom:12px;">+ Add to
                    list</button>
                <button class="btn-primary" onclick="nextWizardStep(2)">Next: Team Details</button>
            </div>
            <div id="wizStep2" class="wizard-step">
                <div style="text-align:center; margin-bottom:20px;">
                    <div
                        style="width:60px; height:60px; background:rgba(16,185,129,0.1); border-radius:50%; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; color:#10b981; font-size:24px;">
                        <i class="ph-bold ph-identification-card"></i>
                    </div>
                    <h4 style="margin-bottom:4px;">Identity</h4>
                    <p style="font-size:12px; color:#888;">Name your squad.</p>
                </div>
                <div class="form-group">
                    <label class="form-label">Team Name</label>
                    <input type="text" id="wizTeamName" class="input-field" placeholder="e.g. Q1 Marketing">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" id="wizTeamDesc" class="input-field" placeholder="Project goals...">
                </div>
                <button class="btn-primary" onclick="nextWizardStep(3)">Next: Kickoff</button>
            </div>
            <div id="wizStep3" class="wizard-step">
                <div style="text-align:center; margin-bottom:20px;">
                    <div
                        style="width:60px; height:60px; background:rgba(16,185,129,0.1); border-radius:50%; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; color:#10b981; font-size:24px;">
                        <i class="ph-bold ph-rocket-launch"></i>
                    </div>
                    <h4 style="margin-bottom:4px;">Launch It</h4>
                    <p style="font-size:12px; color:#888;">Schedule the kickoff meeting.</p>
                </div>
                <div class="form-group">
                    <label class="form-label">Kickoff Date</label>
                    <div class="date-row">
                        <input type="date" id="wizDate" class="input-field">
                        <input type="time" id="wizTime" class="input-field" value="09:00">
                    </div>
                </div>
                <button class="btn-primary" onclick="finishWizard()">
                    Create Team & Schedule <i class="ph-bold ph-check"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="profileModal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Benedict Profile</h3>
                <div class="close-btn" onclick="closeModals()"><i class="ph-bold ph-x"></i></div>
            </div>
            <div class="profile-swipe-container">
                <div class="profile-card-page">
                    <div style="text-align:center; margin-bottom:12px;">
                        <div id="profilePreview" onclick="document.getElementById('dash_avatar_input').click()"
                            style="width:80px; height:80px; background:#333; border-radius:24px; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative; cursor:pointer;">
                            <span id="profileInitials" style="font-size:24px; font-weight:700; color:#888;">BA</span>
                            <img id="dashAvatarImg" src=""
                                style="width:100%; height:100%; object-fit:cover; display:none;">
                            <div
                                style="position:absolute; bottom:0; width:100%; padding:4px; background:rgba(0,0,0,0.5); font-size:9px; color:#fff;">
                                EDIT</div>
                        </div>
                        <input type="file" id="dash_avatar_input" accept="image/*" style="display:none;"
                            onchange="handleDashAvatar(this)">
                        <input type="text" id="displayProfName" value="Benedict Adurosakin"
                            style="font-size:18px; margin-bottom:4px; background:transparent; border:none; color:var(--text-primary); text-align:center; width:100%; font-weight:700;">
                        <div style="display:flex; align-items:center; justify-content:center; gap:8px;">
                            <span style="width:8px; height:8px; background:#10b981; border-radius:50%;"></span>
                            <input type="text" id="displayJobTitle" value="Clinical Informatics Nurse"
                                style="font-size:12px; color:var(--text-secondary); background:transparent; border:none; text-align:center; width:200px;">
                        </div>
                    </div>

                    <!-- EDITABLE FIELDS -->
                    <style>
                        .prof-input {
                            width: 100%;
                            background: transparent;
                            border: none;
                            color: var(--text-primary);
                            text-align: right;
                            font-size: 13px;
                            outline: none;
                            border-bottom: 1px solid transparent;
                        }

                        .prof-input:focus {
                            border-bottom: 1px solid var(--accent);
                        }
                    </style>

                    <div class="profile-list-item">
                        <span class="profile-label">Role</span>
                        <!-- This is duplicative of Job Title usually, but let's keep as user requested separate fields or just sync -->
                        <!-- User asked for Job Title input in Sign Up. Let's map that here as well. -->
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_role"
                                placeholder="Detailed Role"></div>
                    </div>
                    <div class="profile-list-item">
                        <span class="profile-label">Location</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_loc"
                                placeholder="City, Country"></div>
                    </div>
                    <div class="profile-list-item" style="border-bottom:none;">
                        <span class="profile-label">Projects</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_proj"
                                placeholder="Current Projects"></div>
                    </div>
                    <div style="text-align:center; margin-top:auto; color:#888; font-size:10px;">
                        <i class="ph-bold ph-arrow-right"></i> Swipe for Contact
                    </div>
                </div>
                <div class="profile-card-page">
                    <div
                        style="font-size:14px; font-weight:700; margin-bottom:16px; border-bottom:1px solid var(--border); padding-bottom:8px;">
                        Contact Details</div>
                    <div class="profile-list-item">
                        <span class="profile-label">Email</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_email">
                        </div>
                    </div>
                    <div class="profile-list-item">
                        <span class="profile-label">Phone</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_phone"
                                placeholder="+00-000-000-0000"></div>
                    </div>
                    <div class="profile-list-item">
                        <span class="profile-label">Links</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_links"
                                placeholder="linktr.ee/..."></div>
                    </div>
                    <div class="profile-list-item">
                        <span class="profile-label">Alias</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_alias"
                                placeholder="@alias"></div>
                    </div>

                    <button class="btn-primary" onclick="saveDashboardProfile()"
                        style="margin-top:20px; font-size:12px;">Save Changes</button>

                    <div style="background:#1a1a1a; padding:12px; border-radius:12px; display:flex; justify-content:space-between; align-items:center; margin-top:16px; border:1px solid var(--border); cursor:pointer;"
                        onclick="showToast('Link Copied')">
                        <span class="profile-label" style="font-size:11px;">Copy direct chat link</span>
                        <i class="ph-bold ph-copy" style="color:#888;"></i>
                    </div>
                </div>
                <div class="profile-card-page">
                    <div
                        style="font-size:14px; font-weight:700; margin-bottom:16px; border-bottom:1px solid var(--border); padding-bottom:8px;">
                        App Settings</div>

                    <!-- THEME TOGGLE -->
                    <div class="profile-list-item" onclick="toggleTheme()">
                        <span class="profile-label">Theme</span>
                        <div class="profile-val">Toggle <i class="ph-bold ph-moon" id="profThemeIcon"></i></div>
                    </div>

                    <!-- NOTIFICATIONS -->
                    <div class="profile-list-item">
                        <span class="profile-label">Notifications</span>
                        <div class="profile-val" onclick="toggleSetting('notify')">
                            <span id="set_notify_text">On</span>
                            <i class="ph-bold ph-toggle-right" id="set_notify_icon"
                                style="color:#10b981; font-size:16px; vertical-align:middle; margin-left:4px;"></i>
                        </div>
                    </div>

                    <!-- REMINDERS -->
                    <div class="profile-list-item">
                        <span class="profile-label">Meeting Reminders</span>
                        <div class="profile-val">
                            <select id="pf_reminders" onchange="saveSetting('reminders', this.value)"
                                style="background:transparent; border:none; color:var(--text-secondary); text-align:right; outline:none;">
                                <option value="5 mins">5 mins before</option>
                                <option value="15 mins">15 mins before</option>
                                <option value="30 mins">30 mins before</option>
                                <option value="Off">Off</option>
                            </select>
                        </div>
                    </div>

                    <button style="margin-top:auto; color:#ef4444; font-size:12px; font-weight:600;"
                        onclick="signOut()">Sign Out</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/dashboard.js"></script>

    <script type="module" defer>
        import Chatbot from "https://cdn.n8nchatui.com/v1/embed.js";

        Chatbot.init({
            "n8nChatUrl": "https://ciroma.app.n8n.cloud/webhook/058f5cca-0b25-4ef1-ae1a-6ce8b48d6450/chat",
            "metadata": {},
            "theme": {
                "button": {
                    "backgroundColor": "#ffffff",
                    "right": 20,
                    "bottom": 20,
                    "size": 56,
                    "iconColor": "#000000",
                    "customIconSrc": "https://www.svgrepo.com/show/529481/chat-round-dots.svg",
                    "customIconSize": 28,
                    "borderRadius": "50",
                    "autoWindowOpen": {
                        "autoOpen": false,
                        "openDelay": 2
                    }
                },
                "tooltip": {
                    "showTooltip": true,
                    "tooltipMessage": "KAIROS AI",
                    "tooltipBackgroundColor": "#111",
                    "tooltipTextColor": "#fff",
                    "tooltipFontSize": 12
                },
                "chatWindow": {
                    "showTitle": true,
                    "title": "KAIROS AI",
                    "titleAvatarSrc": "https://www.svgrepo.com/show/529481/chat-round-dots.svg",
                    "welcomeMessage": "Hello! I can help you schedule meetings or analyze documents.",
                    "errorMessage": "Connection interrupted.",
                    "backgroundColor": "#050505",
                    "height": 600,
                    "width": 380,
                    "fontSize": 14,
                    "renderHTML": true,
                    "botMessage": {
                        "backgroundColor": "#262626",
                        "textColor": "#e5e7eb",
                        "showAvatar": true,
                        "avatarSrc": "https://www.svgrepo.com/show/529481/chat-round-dots.svg"
                    },
                    "userMessage": {
                        "backgroundColor": "#ffffff",
                        "textColor": "#000000",
                        "showAvatar": false
                    },
                    "textInput": {
                        "placeholder": "Type your command...",
                        "backgroundColor": "#1a1a1a",
                        "textColor": "#ffffff",
                        "sendButtonColor": "#ffffff",
                        "maxChars": 200,
                        "borderRadius": 20,
                        "sendButtonBorderRadius": 20
                    },
                    "uploadsConfig": {
                        "enabled": true,
                        "maxFiles": 5,
                        "maxSizeInMB": 10
                    }
                }
            }
        });
    </script>
    <script src="js/dashboard.js"></script>
</body>

</html>
<script>
    function handleDashAvatar(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const base64 = e.target.result;
                localStorage.setItem('kairos_avatar', base64);
                const img = document.getElementById('dashAvatarImg');
                if (img) {
                    img.src = base64;
                    img.style.display = 'block';
                    const ini = document.getElementById('profileInitials');
                    if (ini) ini.style.display = 'none';
                }
                const dock = document.getElementById('dockAvatar');
                if (dock) dock.innerHTML = `<img src='${base64}' style='width:100%; height:100%; object-fit:cover;'>`;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>