<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <script src="js/auth-guard.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KAIROS | Memory Vault</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@500;700&family=JetBrains+Mono:wght@400&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="css/vault.css">
    <script src="js/components.js"></script>
    <script>
        const savedTheme = localStorage.getItem('kairosTheme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);

        document.addEventListener('DOMContentLoaded', () => {
            renderSidebar('vault');
            updateVaultLogo();
        });

        // ... (Keep existing vault logic if not in sidebar)
    </script>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>

<body>


    <!-- SIDEBAR CONTAINER -->
    <div id="sidebar-container"></div>

    <!-- MAIN CONTENT AREA -->
    <div id="main">

        <!-- MEMORY VAULT VIEW -->
        <div id="view-vault" class="view-section active">
            <!-- Vault Sidebar list -->
            <div class="vault-sidebar" id="timelinePanel">
                <div class="search-header">
                    <div
                        style="font-family:'Space Grotesk'; font-weight:700; font-size:18px; margin-bottom:12px; display:flex; justify-content:space-between; align-items:center;">
                        <span id="mobileTitle">Memory Vault</span>
                        <button onclick="toggleContextDropdown()"
                            style="font-size:12px; background:var(--surface-hover); padding:4px 8px; border-radius:6px; display:none; color:var(--text-primary); border:none;"
                            id="mobileCtxBtn">Design</button>
                    </div>
                    <div class="search-box">
                        <i class="ph-bold ph-magnifying-glass"></i>
                        <input type="text" placeholder="Search decisions..." onkeyup="filterMeetings(this.value)">
                    </div>
                </div>
                <div class="meeting-list" id="meetingList"></div>
            </div>

            <!-- Vault Detail Content -->
            <div class="vault-content" id="vaultContentPanel">
                <div class="mobile-back-btn" onclick="closeDetailView()"><i class="ph-bold ph-arrow-left"></i> Back to
                    list</div>
                <div id="vaultDetailContainer">
                    <!-- Dynamic Content -->
                </div>
            </div>

            <!-- Floating Action Button -->
            <div class="fab-container">
                <button class="btn-primary" style="border-radius:50px; padding:12px 24px; box-shadow:var(--shadow);"
                    onclick="openMeetingHub()">
                    <i class="ph-bold ph-plus"></i> New Meeting
                </button>
            </div>
        </div>

        <!-- TEAM CHAT VIEW -->
        <div id="view-teamchat" class="view-section">
            <div class="view-header">
                <div class="view-title">Team Chat</div>
                <button onclick="showToast('New Chat')"
                    style="width:32px; height:32px; background:var(--text-primary); color:var(--bg-main); border-radius:8px; display:flex; align-items:center; justify-content:center;"><i
                        class="ph-bold ph-pencil-simple"></i></button>
            </div>
            <div class="content-list" id="chatListContainer"></div>
        </div>

        <!-- CHAT DETAIL SUB-VIEW -->
        <div id="view-chat-detail" class="view-section" style="background:var(--bg-main);">
            <div class="view-header" style="background:var(--bg-panel);">
                <div style="display:flex; align-items:center; gap:12px;">
                    <button onclick="closeChatDetail()"><i class="ph-bold ph-arrow-left"></i></button>
                    <div class="view-title" id="chatDetailTitle">Chat</div>
                </div>
                <i class="ph-bold ph-info" style="color:var(--text-secondary)"></i>
            </div>
            <div class="content-list" id="chatDetailMessages"
                style="display:flex; flex-direction:column; justify-content:flex-end; padding-bottom:20px;"></div>
            <div
                style="padding:16px; background:var(--bg-panel); border-top:1px solid var(--border); display:flex; gap:10px;">
                <input type="text" class="input-field" placeholder="Type a message..." style="border-radius:24px;">
                <button
                    style="width:40px; height:40px; background:var(--accent); border-radius:50%; color:#000; flex-shrink:0; display:flex; align-items:center; justify-content:center;"><i
                        class="ph-bold ph-paper-plane-right"></i></button>
            </div>
        </div>

        <!-- DOCS VIEW -->
        <div id="view-docs" class="view-section">
            <div class="view-header">
                <div class="view-title">Documents</div>
                <button onclick="createNewDoc()"
                    style="width:32px; height:32px; background:var(--text-primary); color:var(--bg-main); border-radius:8px; display:flex; align-items:center; justify-content:center;"><i
                        class="ph-bold ph-plus"></i></button>
            </div>
            <div class="pill-nav-container">
                <div class="pill-nav active" onclick="filterDocs('all', this)">All Files</div>
                <div class="pill-nav" onclick="filterDocs('recent', this)">Recent</div>
                <div class="pill-nav" onclick="filterDocs('shared', this)">Shared</div>
                <div class="pill-nav" onclick="filterDocs('starred', this)">Starred</div>
            </div>
            <div class="content-list" id="docsList"></div>

            <!-- FAB for Docs (if needed, but header btn exists) -->
        </div>

    </div>

    <!-- MODALS -->
    <!-- Meeting Hub Modal -->
    <div class="modal-overlay" id="meetingHub">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Start Meeting</h3>
                <i class="ph-bold ph-x close-btn" onclick="closeModals()"></i>
            </div>
            <div class="meeting-grid">
                <button class="meeting-opt" onclick="openStartCallModal()">
                    <div class="meeting-icon"><i class="ph-fill ph-video-camera"></i></div>
                    <div class="meeting-label">Instant Meeting</div>
                </button>
                <button class="meeting-opt" onclick="openScheduleModal()">
                    <div class="meeting-icon"><i class="ph-fill ph-calendar-plus"></i></div>
                    <div class="meeting-label">Schedule</div>
                </button>
                <button class="meeting-opt" onclick="openDialPad()">
                    <div class="meeting-icon"><i class="ph-fill ph-phone"></i></div>
                    <div class="meeting-label">Dial Out</div>
                </button>
                <button class="meeting-opt" onclick="openLinkModal()">
                    <div class="meeting-icon"><i class="ph-fill ph-link"></i></div>
                    <div class="meeting-label">Get Link</div>
                </button>
            </div>
        </div>
    </div>

    <!-- Start Instant Call Modal -->
    <div class="modal-overlay" id="startCallModal">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Instant Meeting</h3>
                <i class="ph-bold ph-x close-btn" onclick="closeModals()"></i>
            </div>

            <div id="startCallContent">
                <div class="form-group">
                    <label class="form-label">Meeting Name</label>
                    <input type="text" class="input-field" value="Quick Sync" id="instantMeetingName">
                </div>
                <div class="form-group">
                    <label class="form-label">Context</label>
                    <div
                        style="font-size:13px; padding:10px; background:var(--surface-hover); border-radius:8px; display:flex; align-items:center; gap:8px;">
                        <i class="ph-fill ph-circles-three-plus" style="color:var(--accent)"></i>
                        <span id="modalInstantContext">Current Workspace</span>
                    </div>
                </div>
                <div class="call-type-row">
                    <div class="call-type-btn" onclick="initiateCall('video')">
                        <i class="ph-fill ph-video-camera call-type-icon"></i>
                        <span style="font-size:12px; font-weight:600;">Video</span>
                    </div>
                    <div class="call-type-btn" onclick="initiateCall('audio')">
                        <i class="ph-fill ph-microphone call-type-icon"></i>
                        <span style="font-size:12px; font-weight:600;">Audio</span>
                    </div>
                </div>
            </div>

            <!-- Loader State -->
            <div id="preCallLoader" style="display:none; text-align:center; padding:20px;">
                <div class="spinner-large"></div>
                <div style="margin-top:16px; font-size:14px; font-weight:600; color:#10b981;">Establishing Secure Line
                </div>
                <div style="font-size:12px; color:var(--text-secondary); margin-top:4px;" id="connText">Connecting to
                    Kairos Network...</div>
            </div>

        </div>
    </div>

    <!-- Get Link Modal -->
    <div class="modal-overlay" id="linkModal">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Meeting Link</h3>
                <i class="ph-bold ph-x close-btn" onclick="closeModals()"></i>
            </div>
            <div class="av-toggle">
                <div class="av-btn active" id="btnVideo" onclick="toggleLinkType('video')"><i
                        class="ph-bold ph-video-camera"></i> Video</div>
                <div class="av-btn" id="btnAudio" onclick="toggleLinkType('audio')"><i
                        class="ph-bold ph-microphone"></i> Audio</div>
            </div>
            <div class="call-link-box">
                <div class="link-text" id="callLink">https://call.kairos.ai/video/bSecFu29x</div>
                <button class="copy-btn" onclick="copyLink()"><i class="ph-bold ph-copy"></i></button>
            </div>
            <button class="btn-primary" onclick="sendToWhatsapp()"><i class="ph-bold ph-whatsapp-logo"></i> Share via
                WhatsApp</button>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div class="modal-overlay" id="scheduleModal">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Schedule Meeting</h3>
                <i class="ph-bold ph-x close-btn" onclick="closeModals()"></i>
            </div>
            <div class="form-group">
                <label class="form-label">Title</label>
                <input type="text" class="input-field" placeholder="e.g. Q1 Roadmap Review">
            </div>
            <div class="date-row">
                <div class="form-group" style="flex:1">
                    <label class="form-label">Date</label>
                    <input type="date" class="input-field">
                </div>
                <div class="form-group" style="flex:1">
                    <label class="form-label">Time</label>
                    <input type="time" class="input-field" value="10:00">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Invite Team (Optional)</label>
                <div style="display:flex; gap:8px;">
                    <select class="input-field" id="teamSelector">
                        <option value="" disabled selected>Select Team...</option>
                        <option value="Design Team">Design Team</option>
                        <option value="Engineering">Engineering</option>
                    </select>
                </div>
            </div>
            <button class="btn-primary" onclick="showToast('Meeting Scheduled'); closeModals();">Schedule Event</button>
            <div style="margin-top:16px; padding-top:16px; border-top:1px solid rgba(255,255,255,0.1);">
                <button class="btn-primary" style="background:#fff; color:#000; margin-top:0;"
                    onclick="initCalendarAuth(event)">
                    <i class="ph-bold ph-google-logo"></i> Sync with Google Calendar
                </button>
            </div>
        </div>
    </div>

    <!-- Dial Pad Modal -->
    <div class="modal-overlay" id="dialPadModal">
        <div class="modal-card" style="max-width:320px;">
            <div class="modal-header">
                <h3>Dial Out</h3>
                <i class="ph-bold ph-x close-btn" onclick="closeModals()"></i>
            </div>
            <div class="dial-display" id="dialDisplay"></div>
            <div class="dial-grid">
                <div class="dial-key" onclick="pressKey('1')">1</div>
                <div class="dial-key" onclick="pressKey('2')">2</div>
                <div class="dial-key" onclick="pressKey('3')">3</div>
                <div class="dial-key" onclick="pressKey('4')">4</div>
                <div class="dial-key" onclick="pressKey('5')">5</div>
                <div class="dial-key" onclick="pressKey('6')">6</div>
                <div class="dial-key" onclick="pressKey('7')">7</div>
                <div class="dial-key" onclick="pressKey('8')">8</div>
                <div class="dial-key" onclick="pressKey('9')">9</div>
                <div class="dial-key" onclick="pressKey('*')">*</div>
                <div class="dial-key" onclick="pressKey('0')">0</div>
                <div class="dial-key" onclick="pressKey('#')">#</div>
            </div>
            <div style="display:flex; justify-content:center; gap:20px; margin-top:20px; align-items:center;">
                <div class="dial-key" style="background:transparent; color:#888;" onclick="pressKey('del')"><i
                        class="ph-bold ph-backspace"></i></div>
                <div class="dial-key dial-action" onclick="showToast('Calling...')"><i class="ph-fill ph-phone"></i>
                </div>
                <div class="dial-key" style="background:transparent; color:#888;"></div>
            </div>
        </div>
    </div>

    <!-- Profile Modal (Synced with Dashboard) -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal-card">
            <div class="modal-header">
                <h3>My Profile</h3>
                <i class="ph-bold ph-x close-btn" onclick="closeModals()"></i>
            </div>

            <div class="profile-swipe-container">

                <div class="profile-card-page">
                    <div style="text-align:center; margin-bottom:12px;">
                        <div id="profilePreview"
                            style="width:80px; height:80px; background:#333; border-radius:24px; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative;">
                            <span id="profileInitials" style="font-size:24px; font-weight:700; color:#888;">BA</span>
                        </div>
                        <input type="text" id="displayProfName" value="Benedict Adurosakin"
                            style="font-size:18px; margin-bottom:4px; background:transparent; border:none; color:var(--text-primary); text-align:center; width:100%; font-weight:700;">
                        <div style="display:flex; align-items:center; justify-content:center; gap:8px;">
                            <span style="width:8px; height:8px; background:#10b981; border-radius:50%;"></span>
                            <input type="text" id="displayJobTitle" value="Professional"
                                style="font-size:12px; color:var(--text-secondary); background:transparent; border:none; text-align:center; width:200px;">
                        </div>
                    </div>

                    <style>
                        .prof-input {
                            width: 100%;
                            background: transparent;
                            border: none;
                            color: var(--text-primary);
                            text-align: right;
                            font-size: 13px;
                            outline: none;
                            border-bottom: 1px solid transparent;
                        }

                        .prof-input:focus {
                            border-bottom: 1px solid var(--accent);
                        }
                    </style>

                    <div class="profile-list-item">
                        <span class="profile-label">Role</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_role"
                                placeholder="Detailed Role"></div>
                    </div>
                    <div class="profile-list-item">
                        <span class="profile-label">Location</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_loc"
                                placeholder="City, Country"></div>
                    </div>
                    <div class="profile-list-item" style="border-bottom:none;">
                        <span class="profile-label">Projects</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_proj"
                                placeholder="Current Projects"></div>
                    </div>
                </div>

                <div class="profile-card-page">
                    <div
                        style="font-size:14px; font-weight:700; margin-bottom:16px; border-bottom:1px solid var(--border); padding-bottom:8px;">
                        Contact Details</div>
                    <div class="profile-list-item">
                        <span class="profile-label">Email</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_email">
                        </div>
                    </div>
                    <div class="profile-list-item">
                        <span class="profile-label">Phone</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_phone"
                                placeholder="+00-000-000-0000"></div>
                    </div>
                    <div class="profile-list-item">
                        <span class="profile-label">Links</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_links"
                                placeholder="linktr.ee/..."></div>
                    </div>
                    <div class="profile-list-item">
                        <span class="profile-label">Alias</span>
                        <div class="profile-val" style="flex:1;"><input type="text" class="prof-input" id="pf_alias"
                                placeholder="@alias"></div>
                    </div>
                    <button class="btn-primary" onclick="saveDashboardProfile()"
                        style="margin-top:20px; font-size:12px;">Save Changes</button>
                </div>
            </div>

            <button class="btn-primary"
                style="background:var(--surface-hover); border:1px solid var(--border); color:var(--text-primary); margin-top:20px;"
                onclick="signOut()">Sign Out</button>
        </div>
    </div>

    <!-- Inject Dashboard Logic for Profile Handling -->
    <script>
        // Init Data
        document.addEventListener('DOMContentLoaded', () => {
            const user = localStorage.getItem('kairos_user') || 'Guest';
            const job = localStorage.getItem('kairos_job_title') || 'Professional';

            // Dock
            const dockName = document.getElementById('dockName');
            if (dockName) dockName.innerText = user;
            const dockAvatar = document.getElementById('dockAvatar');
            if (dockAvatar) {
                const initials = user.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                dockAvatar.innerHTML = `<span>${initials}</span>`;
            }

            // Populate Modal
            if (document.getElementById('displayProfName')) document.getElementById('displayProfName').value = user;
            if (document.getElementById('displayJobTitle')) document.getElementById('displayJobTitle').value = job;
            if (document.getElementById('profileInitials')) document.getElementById('profileInitials').innerText = user.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();

            if (document.getElementById('pf_role')) document.getElementById('pf_role').value = localStorage.getItem('kairos_role_desc') || job;
            if (document.getElementById('pf_loc')) document.getElementById('pf_loc').value = localStorage.getItem('kairos_location') || 'Lagos, Nigeria';
            if (document.getElementById('pf_proj')) document.getElementById('pf_proj').value = localStorage.getItem('kairos_project') || '';
            if (document.getElementById('pf_email')) document.getElementById('pf_email').value = localStorage.getItem('kairos_email') || '';
            if (document.getElementById('pf_phone')) document.getElementById('pf_phone').value = localStorage.getItem('kairos_phone') || '';
            if (document.getElementById('pf_links')) document.getElementById('pf_links').value = localStorage.getItem('kairos_links') || '';
            if (document.getElementById('pf_alias')) document.getElementById('pf_alias').value = localStorage.getItem('kairos_alias') || '';

            updateVaultLogo();
        });

        function updateVaultLogo() {
            const theme = document.documentElement.getAttribute('data-theme');
            const logo = document.getElementById('vaultLogo');
            if (logo) {
                logo.src = theme === 'dark' ? 'icons/new-Kairos-Logo-white.png' : 'icons/new-Kairos-Logo-black.png';
            }
        }

        // Override toggleTheme to update logo
        const _origToggle = window.toggleTheme;
        window.toggleTheme = function () {
            if (_origToggle) _origToggle(); // Call vault.js toggle if exists or similar
            else {
                const current = document.documentElement.getAttribute('data-theme');
                const newTheme = current === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('kairosTheme', newTheme);
                // Update icon
                const icon = document.getElementById('themeIcon');
                if (icon) icon.className = newTheme === 'dark' ? 'ph-bold ph-moon' : 'ph-bold ph-sun';
            }
            updateVaultLogo();
        }

        function saveDashboardProfile() {
            const name = document.getElementById('displayProfName').value;
            const job = document.getElementById('displayJobTitle').value;
            // Save core
            localStorage.setItem('kairos_user', name);
            localStorage.setItem('kairos_job_title', job);
            // Save extra
            localStorage.setItem('kairos_role_desc', document.getElementById('pf_role').value);
            localStorage.setItem('kairos_location', document.getElementById('pf_loc').value);
            localStorage.setItem('kairos_project', document.getElementById('pf_proj').value);
            localStorage.setItem('kairos_email', document.getElementById('pf_email').value);
            localStorage.setItem('kairos_phone', document.getElementById('pf_phone').value);
            localStorage.setItem('kairos_links', document.getElementById('pf_links').value);
            localStorage.setItem('kairos_alias', document.getElementById('pf_alias').value);

            alert('Profile Updated');
            // Refresh Dock
            document.getElementById('dockName').innerText = name;
            document.getElementById('profileInitials').innerText = name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        }

        function signOut() {
            localStorage.setItem('kairos_auth', 'false');
            window.location.href = 'login.html';
        }
    </script>
    <script src="js/vault.js"></script>

</body>

</html>